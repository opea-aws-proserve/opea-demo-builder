{
    "version": "0.2",
    "env": {
      "shell": "bash"
    },
    "phases": {
      "build": {
        "commands": [
          "npm install -g aws-cdk",
          "mkdir workshop && cd workshop",
          "git clone --single-branch --branch $REPO_BRANCH_NAME $REPO_URL .",
          "echo $EVENT_REQUEST_TYPE",
          "export IS_WORKSHOP=workshop",
          "export OPEA_ROLE_ARN=$PARTICIPANT_ROLE_ARN",
          "export OPEA_ROLE_NAME=WSOpsRole",
          "export OPEA_USERS=WSControlPlaneUser",
          "export HUGGINGFACEHUB_API_TOKEN=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",
          "chmod +x ../scripts/start.sh",
          "./scripts/start.sh $EVENT_REQUEST_TYPE"
        ]
      },
      "post_build": {
        "commands": [
          "if [ \"$CODEBUILD_BUILD_SUCCEEDING\" == \"1\" ]; then export STATUS=\"SUCCESS\"; fi",
          "if [ \"$CODEBUILD_BUILD_SUCCEEDING\" != \"1\" ]; then export STATUS=\"FAILED\"; fi",
          "export JSON_DATA=\"{\"Status\" : \"$STATUS\", \"Reason\" : \"See the details in CloudWatch Log Stream: $CONTEXT_LOG_STREAM_NAME\", \"StackId\" : \"$EVENT_STACK_ID\", \"PhysicalResourceId\" : \"$CONTEXT_LOG_STREAM_NAME\", \"RequestId\" : \"$EVENT_REQUEST_ID\", \"LogicalResourceId\" : \"$EVENT_LOGICAL_RESOURCE_ID\" }\"",
          "echo \"$JSON_DATA\"",
          "curl -X PUT --data-binary \"$JSON_DATA\" \"$EVENT_RESPONSE_URL\""
        ]
      }
    }
  }